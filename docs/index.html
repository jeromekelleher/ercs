<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Extinction/recolonisation coalescent simulator &mdash; ercs v1.0.0 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="ercs v1.0.0 documentation" href="#" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li><a href="#">ercs v1.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="extinction-recolonisation-coalescent-simulator">
<h1><a class="toc-backref" href="#id8">Extinction/recolonisation coalescent simulator</a><a class="headerlink" href="#extinction-recolonisation-coalescent-simulator" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
</ul>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#extinction-recolonisation-coalescent-simulator" id="id8">Extinction/recolonisation coalescent simulator</a><ul>
<li><a class="reference internal" href="#introduction" id="id9">Introduction</a></li>
<li><a class="reference internal" href="#examples" id="id10">Examples</a><ul>
<li><a class="reference internal" href="#basic-usage" id="id11">Basic usage</a></li>
<li><a class="reference internal" href="#oriented-trees-and-forests" id="id12">Oriented trees and forests</a></li>
<li><a class="reference internal" href="#most-recent-common-ancestors" id="id13">Most recent common ancestors</a></li>
<li><a class="reference internal" href="#multiple-loci" id="id14">Multiple loci</a></li>
<li><a class="reference internal" href="#parallelism" id="id15">Parallelism</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-ercs" id="id16"><tt class="xref docutils literal"><span class="pre">ercs</span></tt> &#8211; Module reference</a><ul>
<li><a class="reference internal" href="#ercs-simulator" id="id17"><a title="ercs.Simulator" class="reference internal" href="#ercs.Simulator"><tt class="xref docutils literal"><span class="pre">ercs.Simulator</span></tt></a></a></li>
<li><a class="reference internal" href="#event-classes" id="id18">Event Classes</a></li>
<li><a class="reference internal" href="#utilities" id="id19">Utilities</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-_ercs" id="id20"><tt class="xref docutils literal"><span class="pre">_ercs</span></tt> &#8211; Module reference</a><ul>
<li><a class="reference internal" href="#low-level-event-classes" id="id21">Low Level Event Classes</a></li>
<li><a class="reference internal" href="#simulation-interface" id="id22">Simulation interface</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bibliography" id="id23">Bibliography</a></li>
</ul>
</li>
<li><a class="reference internal" href="#indices-and-tables" id="id24">Indices and tables</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id9">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This document provides a reference to the <tt class="docutils literal"><span class="pre">ercs</span></tt> Python module, which provides
a straightforward interface to coalescent simulations of the
extinction/recolonisation model. See <a class="reference internal" href="#e08">[E08]</a>, <a class="reference internal" href="#bev10">[BEV10]</a> amd <a class="reference internal" href="#bke10">[BKE10]</a></p>
</div>
<div class="section" id="examples">
<h2><a class="toc-backref" href="#id10">Examples</a><a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>The most important features of <tt class="docutils literal"><span class="pre">ercs</span></tt> are illustrated by means of a series of
examples.</p>
<div class="section" id="basic-usage">
<h3><a class="toc-backref" href="#id11">Basic usage</a><a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h3>
<p>The basic pattern of usage for the <tt class="docutils literal"><span class="pre">ercs</span></tt> module is to allocate an instance of
the Simulator class, set some attributes on this instance, and then run
simulate for some random seed. There are sensible defaults for most of the
parameters in Simulator, but we must provide values for at least two of them
before we can simulate. These are the <tt class="docutils literal"><span class="pre">sample</span></tt> and <tt class="docutils literal"><span class="pre">event_classes</span></tt>
attributes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">ercs</span>

<span class="k">def</span> <span class="nf">first_example</span><span class="p">(</span><span class="n">seed</span><span class="p">):</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">ercs</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span>  <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">event_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ercs</span><span class="o">.</span><span class="n">DiscEventClass</span><span class="p">(</span><span class="n">rate</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">sim</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</pre></div>
</div>
<p>Here we allocate a simulator on a torus of diameter 20,  set up our
sample and event classes, and the run the simulation. We specify a sample
of three lineages, located at points <tt class="docutils literal"><span class="pre">(0,</span> <span class="pre">0)</span></tt>, <tt class="docutils literal"><span class="pre">(0,</span> <span class="pre">5)</span></tt> and <tt class="docutils literal"><span class="pre">(0,</span> <span class="pre">10)</span></tt>.</p>
<p>Describe the event class.</p>
</div>
<div class="section" id="oriented-trees-and-forests">
<h3><a class="toc-backref" href="#id12">Oriented trees and forests</a><a class="headerlink" href="#oriented-trees-and-forests" title="Permalink to this headline">¶</a></h3>
<p>The most part of <tt class="docutils literal"><span class="pre">ercs</span></tt> to understand is the way in which we encode
genealogies. Running the example aboAve, we get</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">first_example</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="go">([[0, 4, 4, 5, 5, 0]], [[0.0, 0.0, 0.0, 0.0, 30441.574004183603, 46750.11224375103]])</span>
</pre></div>
</div>
<p>(Note there is nothing special about the seed 3 here - it is just a value which
produced a neat example to discuss).
This output completely describes the ancestry of the sample, although it&#8217;s not immediately
obvious how. In <tt class="docutils literal"><span class="pre">ercs</span></tt> we use <em>oriented trees</em> to represent the genealogy of a sample.
In an oriented tree, we are only interested in the parent-child relationships between nodes,
and don&#8217;t care about the order of children at a node. Therefore, in an oriented tree
<tt class="docutils literal"><span class="pre">pi</span></tt>, the parent of node <tt class="docutils literal"><span class="pre">j</span></tt> is <tt class="docutils literal"><span class="pre">pi[j]</span></tt>. If we map each node in the tree to a unique
positive integer and adopt the convention that any node whose parent is the
special &#8220;null node&#8221; <tt class="docutils literal"><span class="pre">0</span></tt> is a root,
we can then represent an oriented tree very simply as a list of integers.</p>
<p>In our example above, we have a list of three locations as our sample, and so we map
these to the integers <tt class="docutils literal"><span class="pre">1</span></tt>, <tt class="docutils literal"><span class="pre">2</span></tt> and <tt class="docutils literal"><span class="pre">3</span></tt> (i.e., lineage <tt class="docutils literal"><span class="pre">1</span></tt> is sampled at
location <tt class="docutils literal"><span class="pre">(0,</span> <span class="pre">0)</span></tt> and so on). The <tt class="docutils literal"><span class="pre">simulate</span></tt> method returns a tuple, <tt class="docutils literal"><span class="pre">(pi,</span> <span class="pre">tau)</span></tt>;
<tt class="docutils literal"><span class="pre">pi</span></tt> is a list of oriented forests (one for each locus) and <tt class="docutils literal"><span class="pre">tau</span></tt> is a list of
node times (one for each locus). In the example, we are dealing with a single locus
only, so <tt class="docutils literal"><span class="pre">pi</span></tt> is a list consisting of one list, <tt class="docutils literal"><span class="pre">[0,</span> <span class="pre">4,</span> <span class="pre">4,</span> <span class="pre">5,</span> <span class="pre">5,</span> <span class="pre">0]</span></tt>, that
encodes the following tree:</p>
<img alt="An oriented tree" class="align-center" src="_images/oriented-tree.png" />
<p>The times labelled on the tree are derived from the node times list for this
locus, <tt class="docutils literal"><span class="pre">tau[0]</span></tt>. The node times list associated with an oriented tree
records the time that the associated lineage entered the sample, looking
backwards in time (hence, for each node in the sample the time is <tt class="docutils literal"><span class="pre">0.0</span></tt>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The zero&#8217;th element of an oriented forest and its associated node
time list is <em>not used</em> and is set to zero as a convenience only. Its value
should not be counted on in any way, and may change in the future.</p>
</div>
<p>Oriented <em>forests</em> occur when there is more than one root in a list <tt class="docutils literal"><span class="pre">pi</span></tt>, and
so we have a set of disconnected trees. This can happen when we specify
the <tt class="docutils literal"><span class="pre">max_time</span></tt> attribute, potentially stopping the simulation before
the sample has completely coalesced. Consider the following example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">oriented_forest_example</span><span class="p">(</span><span class="n">seed</span><span class="p">):</span>
    <span class="n">L</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">ercs</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">event_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ercs</span><span class="o">.</span><span class="n">DiscEventClass</span><span class="p">(</span><span class="n">rate</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="p">[(</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">max_time</span> <span class="o">=</span> <span class="mf">1e5</span>
    <span class="n">pi</span><span class="p">,</span> <span class="n">tau</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>Here we allocate a Simulator on a torus of diameter 20 as before and
use the usual event class. This time we allocate a sample of size 10,
arranged regularly in a lattice, and stipulate that the simulation should
continue for no more then 10000 time units. As we&#8217;re only
interested in the structure of the genealogy this time, we just
return the oriented forest at the first locus. Running this, we get</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">oriented_forest_example</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="go">[0, 0, 15, 0, 12, 12, 13, 11, 13, 11, 16, 16, 14, 14, 15, 0, 0, 0, 0, 0]</span>
</pre></div>
</div>
<p>This corresponds to the forest:</p>
<img alt="An oriented forest" class="align-center" src="_images/oriented-forest.png" />
<p>(Note that this forest is <strong>not</strong> a correct representation of the
node times; in any simultation, node <tt class="docutils literal"><span class="pre">n</span> <span class="pre">+</span> <span class="pre">1</span></tt> cannot be more recent
than node <tt class="docutils literal"><span class="pre">n</span></tt>).
In this forest there are <em>four</em> roots: 1, 3, 15 and 16 (we ignore the nodes
after 16 as they are all necessarily zero).</p>
</div>
<div class="section" id="most-recent-common-ancestors">
<h3><a class="toc-backref" href="#id13">Most recent common ancestors</a><a class="headerlink" href="#most-recent-common-ancestors" title="Permalink to this headline">¶</a></h3>
<p>Suppose we wished to estimate the mean coalescence time for
lineages sampled at a variety of distances. We can set our
sample so that the lineages are located at the relevent distances,
but it&#8217;s not clear how we can get:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">mrca_example</span><span class="p">(</span><span class="n">seed</span><span class="p">):</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">ercs</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span>  <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">event_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ercs</span><span class="o">.</span><span class="n">DiscEventClass</span><span class="p">(</span><span class="n">rate</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">pi</span><span class="p">,</span> <span class="n">tau</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">sv</span> <span class="o">=</span> <span class="n">ercs</span><span class="o">.</span><span class="n">MRCACalculator</span><span class="p">(</span><span class="n">pi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;d&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;coal_time&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span>
        <span class="n">mrca</span> <span class="o">=</span> <span class="n">sv</span><span class="o">.</span><span class="n">get_mrca</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="n">coal_time</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">mrca</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">coal_time</span><span class="p">)</span>
</pre></div>
</div>
<p>Running this</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mrca_example</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">d    coal_time</span>
<span class="go">2    44415.5647304</span>
<span class="go">3    44415.5647304</span>
<span class="go">4    44415.5647304</span>
<span class="go">5    87644.571846</span>
<span class="go">6    87644.571846</span>
<span class="go">7    87644.571846</span>
<span class="go">8    87644.571846</span>
<span class="go">9    594298.339466</span>
<span class="go">10   834992.341009</span>
</pre></div>
</div>
</div>
<div class="section" id="multiple-loci">
<h3><a class="toc-backref" href="#id14">Multiple loci</a><a class="headerlink" href="#multiple-loci" title="Permalink to this headline">¶</a></h3>
<p>Dealing with multiple loci.</p>
</div>
<div class="section" id="parallelism">
<h3><a class="toc-backref" href="#id15">Parallelism</a><a class="headerlink" href="#parallelism" title="Permalink to this headline">¶</a></h3>
<p>The most common use of coalescent simulation is to estimate the distribution
of some quantity by aggregating over many different replicates. This is
done in <tt class="docutils literal"><span class="pre">ercs</span></tt> by running the <tt class="docutils literal"><span class="pre">simulate</span></tt> method with different random
seeds, one for each replicate. Since each replicate is then completely
independant, we can easily parallise the process. One possible way
to this is using the <a title="(in Python v2.6)" class="reference external" href="http://docs.python.org/2.6/library/multiprocessing.html#module-multiprocessing"><tt class="xref docutils literal"><span class="pre">multiprocessing</span></tt></a> module:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">ercs</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>

<span class="k">def</span> <span class="nf">parallel_simulate</span><span class="p">(</span><span class="n">seed</span><span class="p">):</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">ercs</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">event_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ercs</span><span class="o">.</span><span class="n">DiscEventClass</span><span class="p">(</span><span class="n">rate</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">pi</span><span class="p">,</span> <span class="n">tau</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">coal_time</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">coal_time</span>

<span class="k">def</span> <span class="nf">parallel_example</span><span class="p">(</span><span class="n">num_replicates</span><span class="p">):</span>
    <span class="n">pool</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">())</span>
    <span class="n">coal_times</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">parallel_simulate</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_replicates</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">coal_times</span><span class="p">)</span> <span class="o">/</span> <span class="n">num_replicates</span>
</pre></div>
</div>
<p>In this example we are working on a torus of diameter 100, so the simulations
require a lot longer to run. On most modern systems we have many CPU cores,
and so we use the multiprocessing module to distribute the work of many
replicates across these cores.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">parallel_example</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="go">2968953.9276501946</span>
</pre></div>
</div>
<p>This is the mean coalescence time among 100 replicates. The multiprocessing
module runs <tt class="docutils literal"><span class="pre">parallel_simulate</span></tt> function for each of the seeds in
a subprocess and collects the coalescence times into the list
<tt class="docutils literal"><span class="pre">coal_times</span></tt>. We then take the mean of this list and return it.
The random seeds are simply the integers from 1 to 100. This is a perfectly
legitimate way to choose seeds for a single example, since the random
sequences for adjacent seeds are not correlated. If, however, we are
are doing lots of simulations with different parameter values or are
distributing our simulations over several machines, it would be better
to spread our choice of seeds out more evenly across the possible space.
One way to do this is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">random</span>
<span class="n">seeds</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)]</span>
</pre></div>
</div>
<p>There is no issue with using the Python random generator within your
code, as the <tt class="docutils literal"><span class="pre">ercs</span></tt> C library generates random numbers independantly
of Python (using the <tt class="docutils literal"><span class="pre">mt19937</span></tt> random number generator from the
<a class="reference external" href="http://www.gnu.org/software/gsl/manual/html_node/Random-number-generator-algorithms.html">GNU Scientific Library</a>).</p>
</div>
</div>
<div class="section" id="module-ercs">
<h2><a class="toc-backref" href="#id16"><tt class="xref docutils literal"><span class="pre">ercs</span></tt> &#8211; Module reference</a><a class="headerlink" href="#module-ercs" title="Permalink to this headline">¶</a></h2>
<p>Simulate the coalescent in the extinction recolonisation under a flexible 
set of parameters and related utilities.</p>
<div class="section" id="ercs-simulator">
<h3><a class="toc-backref" href="#id17"><a title="ercs.Simulator" class="reference internal" href="#ercs.Simulator"><tt class="xref docutils literal"><span class="pre">ercs.Simulator</span></tt></a></a><a class="headerlink" href="#ercs-simulator" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="ercs.Simulator">
<em class="property">class </em><tt class="descclassname">ercs.</tt><tt class="descname">Simulator</tt><big>(</big><em>torus_diameter</em><big>)</big><a class="headerlink" href="#ercs.Simulator" title="Permalink to this definition">¶</a></dt>
<dd><p>Class representing a coalescent simulator for the extinction/recolonisation 
model.</p>
<dl class="method">
<dt id="ercs.Simulator.simulate">
<tt class="descname">simulate</tt><big>(</big><em>random_seed</em><big>)</big><a class="headerlink" href="#ercs.Simulator.simulate" title="Permalink to this definition">¶</a></dt>
<dd>Runs the coalescent simulation for the parameters specified in this 
Simulator and returns the simulated history, (pi, tau).</dd></dl>

</dd></dl>

</div>
<div class="section" id="event-classes">
<h3><a class="toc-backref" href="#id18">Event Classes</a><a class="headerlink" href="#event-classes" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="ercs.DiscEventClass">
<em class="property">class </em><tt class="descclassname">ercs.</tt><tt class="descname">DiscEventClass</tt><big>(</big><em>rate</em>, <em>r</em>, <em>u</em><big>)</big><a class="headerlink" href="#ercs.DiscEventClass" title="Permalink to this definition">¶</a></dt>
<dd>Class representing events from the Disc model, in which all individuals within
distance <em>r</em> of the centre of an event have probability <em>u</em> of dying in the 
event and parents are thrown down uniformly within this disc. 
See <a class="reference internal" href="#e08">[E08]</a>, <a class="reference internal" href="#bev10">[BEV10]</a> or ... for details.</dd></dl>

<dl class="class">
<dt id="ercs.GaussianEventClass">
<em class="property">class </em><tt class="descclassname">ercs.</tt><tt class="descname">GaussianEventClass</tt><big>(</big><em>rate</em>, <em>theta</em>, <em>alpha</em>, <em>u0</em><big>)</big><a class="headerlink" href="#ercs.GaussianEventClass" title="Permalink to this definition">¶</a></dt>
<dd>Class representing events from the Gaussian model, in which an individual at  
distance <em>d</em> of the centre of the event have probability 
<img class="math" src="_images/math/cce1afa36a021361aede55e0453e74264871da87.png" alt="u_0\exp(-d^2/(2\theta^2))"/> of dying in the event. Parents are thrown down 
around the centre of the event according to a 2D Gaussian with variance 
<img class="math" src="_images/math/ce130d89991915e0f88bd671d4cb36bcadaa7a80.png" alt="\theta^2\alpha^2"/>.  See <a class="reference internal" href="#bke10">[BKE10]</a> for details.</dd></dl>

</div>
<div class="section" id="utilities">
<h3><a class="toc-backref" href="#id19">Utilities</a><a class="headerlink" href="#utilities" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="ercs.torus_distance">
<tt class="descclassname">ercs.</tt><tt class="descname">torus_distance</tt><big>(</big><em>x</em>, <em>y</em>, <em>L</em><big>)</big><a class="headerlink" href="#ercs.torus_distance" title="Permalink to this definition">¶</a></dt>
<dd>Returns the Euclidean distance between two points x and y on a 2D
square torus with diameter L.</dd></dl>

<dl class="class">
<dt id="ercs.MRCACalculator">
<em class="property">class </em><tt class="descclassname">ercs.</tt><tt class="descname">MRCACalculator</tt><big>(</big><em>oriented_forest</em><big>)</big><a class="headerlink" href="#ercs.MRCACalculator" title="Permalink to this definition">¶</a></dt>
<dd><p>Class to that allows us to compute the nearest common ancestor of arbitrary
nodes in an oriented forest.</p>
<p>This is an implementation of Schieber and Vishkin&#8217;s nearest common ancestor 
algorithm from TAOCP volume 4A, pg.164-167. Preprocesses the input tree into a 
sideways heap in O(n) time and processes queries for the nearest common 
ancestor between an arbitary pair of nodes in O(1) time.</p>
<dl class="method">
<dt id="ercs.MRCACalculator.get_mrca">
<tt class="descname">get_mrca</tt><big>(</big><em>x</em>, <em>y</em><big>)</big><a class="headerlink" href="#ercs.MRCACalculator.get_mrca" title="Permalink to this definition">¶</a></dt>
<dd>Returns the most recent common ancestor of the nodes x and y, 
or 0 if the nodes belong to different trees.</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="module-_ercs">
<h2><a class="toc-backref" href="#id20"><tt class="xref docutils literal"><span class="pre">_ercs</span></tt> &#8211; Module reference</a><a class="headerlink" href="#module-_ercs" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="xref docutils literal"><span class="pre">ercs</span></tt> module delegates the majority of its work to the low-level <tt class="xref docutils literal"><span class="pre">_ercs</span></tt>
extension module, which is written in C. It is not recommended to call this
module directly - the <tt class="xref docutils literal"><span class="pre">ercs</span></tt> module provides all of the functionality with a
much more straightforward interface. In the interested of completeness,
however, the low-level module is documented here.</p>
<div class="section" id="low-level-event-classes">
<h3><a class="toc-backref" href="#id21">Low Level Event Classes</a><a class="headerlink" href="#low-level-event-classes" title="Permalink to this headline">¶</a></h3>
<blockquote>
In the <tt class="docutils literal"><span class="pre">_ercs</span></tt> module, event classes are specified by dictionaries  of key-value pairs  describing the rate events of a particular class happen, the type of event  and the parameters unique to each event class. Each dictionary must have two fields: <tt class="docutils literal"><span class="pre">rate</span></tt> and <tt class="docutils literal"><span class="pre">type</span></tt>. The <tt class="docutils literal"><span class="pre">rate</span></tt> field specifies the rate that this class of events happens at and is a float. The <tt class="docutils literal"><span class="pre">type</span></tt> field  specifies the type of events. The supported event classes are:</blockquote>
<dl class="docutils">
<dt>Disc Events</dt>
<dd>Events from the disc model have <tt class="docutils literal"><span class="pre">type</span></tt> equal to DISC_EVENT_CLASS and    two further fields: <tt class="docutils literal"><span class="pre">r</span></tt> is a double value specifying the radius of    the event and <tt class="docutils literal"><span class="pre">u</span></tt> is a double value specifying the impact of the event.   Example: <cite>{&#8220;type&#8221;:DISC_EVENT_CLASS, &#8220;rate&#8221;:1.0, &#8220;r&#8221;:2.0,    &#8220;u&#8221;:0.5}</cite></dd>
<dt>Gaussian Events</dt>
<dd>Events from the Gaussian model have <tt class="docutils literal"><span class="pre">type</span></tt> equal to GAUSSIAN_EVENT_CLASS    and three further fields: <tt class="docutils literal"><span class="pre">theta</span></tt> specifies the size of the event,    <tt class="docutils literal"><span class="pre">alpha</span></tt> the relative location of parents and <tt class="docutils literal"><span class="pre">u0</span></tt> the impact.    Example: <cite>{&#8220;type&#8221;:GAUSSIAN_EVENT_CLASS, &#8220;rate&#8221;:1.0, &#8220;theta&#8221;:2.0,    &#8220;u0&#8221;:0.5, &#8220;alpha&#8221;:0.75}</cite></dd>
</dl>
</div>
<div class="section" id="simulation-interface">
<h3><a class="toc-backref" href="#id22">Simulation interface</a><a class="headerlink" href="#simulation-interface" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="_ercs.simulate">
<tt class="descclassname">_ercs.</tt><tt class="descname">simulate</tt><big>(</big><big>)</big><a class="headerlink" href="#_ercs.simulate" title="Permalink to this definition">¶</a></dt>
<dd><p>Allocates an ercs object from the C library, calls the simulate function and returns the resulting genealogy. All arguments must be specified and be in the correct order.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><em>random_seed</em> (long integer) &#8211; The seed used for the GSL random generator</li>
<li><em>torus_diameter</em> (double) &#8211; The diameter of the torus</li>
<li><em>num_parents</em> (unsigned integer) &#8211; The number of parents in each event</li>
<li><em>sample</em> (list of numeric (x, y) tuples) &#8211; The sample of 2D locations</li>
<li><em>event_classes</em> (list of dictionaries; see        <a class="reference internal" href="#low-level-event-classes">Low Level Event Classes</a>) &#8211; The list of event classes and their rates</li>
<li><em>recombination_probabilities</em> (list of doubles) &#8211; probability of recombination between       adjacent loci</li>
<li><em>kdtree_bucket_size</em> (unsigned integer) &#8211; The number of points in a kdtree bucket</li>
<li><em>max_kdtree_insertions</em> (unsigned integer) &#8211; The maximum number of insertions before        the kdtree is rebuilt. If this parameter is 0 then the kdtree will        not be rebuilt</li>
<li><em>max_lineages</em> (unsigned integer) &#8211; The maximum number of extant lineages. The library        preallocates memory to handle this number of lineages; if we run out        during the course of simulation a LibraryError is raised</li>
<li><em>max_time</em> (double) &#8211; the maximum time we simulate back into the past. If this        parameter is 0.0 the simulation will continue until all loci have        coalesced.</li>
<li><em>ancestry_algorithm</em> (unsigned int) &#8211; currently unused</li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">the simulated history of the sample, (pi, tau).</p>
</td>
</tr>
<tr class="field"><th class="field-name">Return type:</th><td class="field-body"><p class="first">a tuple (pi, tau); pi is a list of lists of integers, and         tau is a list of lists of doubles</p>
</td>
</tr>
<tr class="field"><th class="field-name">Raises:</th><td class="field-body"><p class="first">InputError when the input is not correctly formed.</p>
</td>
</tr>
<tr class="field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last">LibraryError when the C library encounters an error</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
<div class="section" id="bibliography">
<h2><a class="toc-backref" href="#id23">Bibliography</a><a class="headerlink" href="#bibliography" title="Permalink to this headline">¶</a></h2>
<table class="docutils citation" frame="void" id="e08" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[E08]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id4">2</a>)</em> A. Etheridge. Drift, draft and structure: some mathematical models of evolution,
<em>Banach Center Publications</em> 80, pp 121&#8211;144, 2008.</td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="bev10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[BEV10]</td><td><em>(<a class="fn-backref" href="#id2">1</a>, <a class="fn-backref" href="#id5">2</a>)</em> N. H.  Barton,  A. M. Etheridge and A. Véber.
A new model for evolution in a spatial continuum, <em>Electronic Journal of
Probability</em> 15:7, 2010.</td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="bke10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[BKE10]</td><td><em>(<a class="fn-backref" href="#id3">1</a>, <a class="fn-backref" href="#id6">2</a>)</em> N. H.  Barton,  J. Kelleher and A. M. Etheridge.
A new model for extinction and recolonisation in two dimensions: quantifying phylogeography,
<em>Evolution</em>, 64(9), pp 2701&#8211;2715, 2010.</td></tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="indices-and-tables">
<h1><a class="toc-backref" href="#id24">Indices and tables</a><a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference external" href="genindex.html"><em>Index</em></a></li>
<li><a class="reference external" href="modindex.html"><em>Module Index</em></a></li>
<li><a class="reference external" href="search.html"><em>Search Page</em></a></li>
</ul>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="#">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">Extinction/recolonisation coalescent simulator</a><ul>
<li><a class="reference external" href="#introduction">Introduction</a></li>
<li><a class="reference external" href="#examples">Examples</a><ul>
<li><a class="reference external" href="#basic-usage">Basic usage</a></li>
<li><a class="reference external" href="#oriented-trees-and-forests">Oriented trees and forests</a></li>
<li><a class="reference external" href="#most-recent-common-ancestors">Most recent common ancestors</a></li>
<li><a class="reference external" href="#multiple-loci">Multiple loci</a></li>
<li><a class="reference external" href="#parallelism">Parallelism</a></li>
</ul>
</li>
<li><a class="reference external" href="#module-ercs"><tt class="docutils literal"><span class="pre">ercs</span></tt> &#8211; Module reference</a><ul>
<li><a class="reference external" href="#ercs-simulator"><tt class="docutils literal"><span class="pre">ercs.Simulator</span></tt></a></li>
<li><a class="reference external" href="#event-classes">Event Classes</a></li>
<li><a class="reference external" href="#utilities">Utilities</a></li>
</ul>
</li>
<li><a class="reference external" href="#module-_ercs"><tt class="docutils literal"><span class="pre">_ercs</span></tt> &#8211; Module reference</a><ul>
<li><a class="reference external" href="#low-level-event-classes">Low Level Event Classes</a></li>
<li><a class="reference external" href="#simulation-interface">Simulation interface</a></li>
</ul>
</li>
<li><a class="reference external" href="#bibliography">Bibliography</a></li>
</ul>
</li>
<li><a class="reference external" href="#indices-and-tables">Indices and tables</a></li>
</ul>

            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/index.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="modindex.html" title="Global Module Index"
             >modules</a> |</li>
        <li><a href="#">ercs v1.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2012, Jerome Kelleher.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.6.
    </div>
  </body>
</html>